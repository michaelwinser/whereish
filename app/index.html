<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#2d3748">
    <meta name="description" content="Privacy-first semantic location sharing">
    <title>Whereish</title>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/svg+xml" href="icon.svg">
    <link rel="apple-touch-icon" href="icon-192.png">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="app">
        <!-- Welcome View (logged-out entry point) -->
        <section class="view hidden" data-view="welcome" id="view-welcome">
            <div class="welcome-screen">
                <header class="welcome-header">
                    <h1 class="logo">Whereish</h1>
                    <p class="welcome-tagline">Privacy-first location sharing</p>
                </header>

                <div class="welcome-location">
                    <p class="welcome-label">You are at:</p>
                    <div id="welcome-hierarchy" class="welcome-hierarchy">
                        <div class="welcome-hierarchy-level">
                            <span class="welcome-hierarchy-icon">üìç</span>
                            <span class="welcome-hierarchy-text">Locating...</span>
                        </div>
                    </div>
                </div>

                <p class="welcome-pitch">
                    Share as much or as little as you want with each contact.
                </p>

                <div class="welcome-actions">
                    <button id="welcome-login-btn" class="btn btn-primary">Log In</button>
                    <button id="welcome-signup-btn" class="btn btn-secondary">Sign Up</button>
                </div>
            </div>
        </section>

        <!-- Main View (logged-in home screen) -->
        <section class="view hidden" data-view="main" id="view-main">
            <header class="header">
                <h1 class="logo">Whereish</h1>
                <button id="settings-btn" class="settings-btn" aria-label="Settings">
                    <span class="settings-icon">&#9881;</span>
                </button>
                <p class="tagline">You are at</p>
            </header>

            <!-- Server Status Banner -->
            <div id="server-status" class="server-status hidden">
                <span class="server-status-icon">‚ö†Ô∏è</span>
                <span class="server-status-text">Backend server not connected</span>
            </div>

            <main class="main">
            <!-- Compact Location Bar -->
            <div id="location-bar" class="location-bar">
                <span class="location-bar-icon">üìç</span>
                <div class="location-bar-content">
                    <span class="location-bar-primary" id="location-bar-primary">Locating...</span>
                    <span class="location-bar-secondary hidden" id="location-bar-secondary"></span>
                </div>
                <div class="location-bar-actions">
                    <button id="save-location-btn" class="btn-icon" title="Save Location" disabled>üíæ</button>
                    <button id="refresh-btn" class="btn-icon" title="Refresh" disabled>üîÑ</button>
                </div>
            </div>

            <!-- Location Error (shown when location fails) -->
            <div id="error-message" class="location-error hidden">
                <p class="error-text"></p>
                <button id="retry-btn" class="btn btn-small">Try Again</button>
            </div>

            <!-- Hidden elements for backwards compatibility -->
            <div id="location-display" class="hidden">
                <div id="status" class="hidden"><span class="status-text"></span></div>
                <div id="named-location-match" class="hidden"><span class="named-match-label"></span></div>
                <div id="location-hierarchy" class="hidden"></div>
            </div>

            <!-- Contacts Section -->
            <section id="contacts-section" class="contacts-section hidden">
                <div class="section-header">
                    <h2>Contacts</h2>
                    <div class="section-header-actions">
                        <button id="add-contact-btn" class="btn-icon" title="Add Contact">+</button>
                        <button id="refresh-contacts-btn" class="btn-icon" title="Refresh">üîÑ</button>
                    </div>
                </div>
                <!-- Pending requests -->
                <div id="pending-requests" class="pending-requests hidden">
                    <div id="incoming-requests"></div>
                    <div id="outgoing-requests"></div>
                </div>
                <div id="contacts-list" class="contacts-list">
                    <p class="empty-state">Loading contacts...</p>
                </div>
            </section>

            <!-- Info Section -->
            <section class="info">
                <details>
                    <summary>How it works</summary>
                    <p>
                        Whereish shows your location as meaningful labels, not coordinates.
                        Your exact position stays on your device - we only display
                        human-readable places like "Seattle, Washington."
                    </p>
                    <p>
                        <strong>Named places:</strong> Save locations with custom names like
                        "Home" or "Office". When you're at a saved place, you'll see its
                        name instead of just the address.
                    </p>
                    <p>
                        <strong>Contacts:</strong> See where your contacts are. Their location
                        is filtered based on the permission level they've granted you. Use the
                        "Share" dropdown to control what each contact can see of your location.
                    </p>
                    <p>
                        <strong>Privacy note:</strong> This prototype uses OpenStreetMap
                        for geocoding. Production version will use on-device geocoding.
                    </p>
                </details>
            </section>
            </main>

            <footer class="footer">
                <p>Planet Earth, at minimum</p>
            </footer>
        </section>
        <!-- End Main View -->

        <!-- Places View -->
        <section class="view hidden" data-view="places" id="view-places">
            <header class="screen-header">
                <h1>My Places</h1>
            </header>
            <main class="main">
                <section class="places-content">
                    <div id="places-list" class="named-locations-list">
                        <p class="empty-state">No saved places yet. Save your current location to get started.</p>
                    </div>
                </section>
            </main>
        </section>
        <!-- End Places View -->

        <!-- Contact Detail View -->
        <section class="view hidden" data-view="contact-detail" id="view-contact-detail">
            <header class="screen-header">
                <button class="back-btn" id="contact-detail-back-btn" aria-label="Back">&larr;</button>
                <h1 id="contact-detail-name">Contact</h1>
            </header>
            <main class="main detail-content">
                <!-- Contact Info -->
                <div class="contact-detail-header">
                    <div class="contact-avatar-large" id="contact-avatar-large">?</div>
                    <div class="contact-detail-info">
                        <div class="contact-detail-fullname" id="contact-detail-fullname">Name</div>
                        <div class="contact-detail-email" id="contact-detail-email">email@example.com</div>
                    </div>
                </div>

                <!-- Their Location -->
                <section class="detail-section">
                    <h2 class="detail-section-title">Their Location</h2>
                    <div id="contact-location-display" class="contact-location-display">
                        <span class="location-text">Unknown</span>
                    </div>
                    <div id="contact-distance" class="contact-distance"></div>
                    <div id="contact-last-updated" class="contact-last-updated"></div>
                </section>

                <!-- What They See of You -->
                <section class="detail-section">
                    <h2 class="detail-section-title">What <span class="contact-first-name">They</span> Sees of You</h2>
                    <div class="permission-control-detail">
                        <label for="detail-permission-select">Share level:</label>
                        <select id="detail-permission-select" class="permission-select">
                            <!-- Options populated by JS -->
                        </select>
                    </div>
                    <div id="permission-preview" class="permission-preview">
                        <span class="preview-label">Preview:</span>
                        <span class="preview-value" id="permission-preview-value">--</span>
                    </div>
                </section>

                <!-- What You See of Them -->
                <section class="detail-section">
                    <h2 class="detail-section-title">What You See of <span class="contact-first-name">Them</span></h2>
                    <div class="permission-info">
                        <span id="received-permission-level" class="permission-received">Unknown</span>
                    </div>
                </section>

                <!-- Actions -->
                <section class="detail-section detail-actions">
                    <button id="remove-contact-btn" class="btn btn-danger">Remove Contact</button>
                </section>
            </main>
        </section>
        <!-- End Contact Detail View -->

        <!-- Settings View -->
        <section class="view hidden" data-view="settings" id="view-settings">
            <header class="screen-header">
                <button class="back-btn" id="settings-back-btn" aria-label="Back">&larr;</button>
                <h1>Settings</h1>
            </header>
            <main class="main settings-content">
                <!-- Account Section -->
                <section class="settings-section">
                    <h2 class="settings-section-title">Account</h2>
                    <div class="settings-item">
                        <span class="settings-item-label">Signed in as</span>
                        <span class="settings-item-value" id="settings-user-email">--</span>
                    </div>
                    <button id="settings-logout-btn" class="btn btn-secondary settings-logout">Log Out</button>
                </section>

                <!-- Privacy Section (placeholders) -->
                <section class="settings-section">
                    <h2 class="settings-section-title">Privacy</h2>
                    <div class="settings-item settings-item-disabled">
                        <span class="settings-item-label">Go Dark</span>
                        <span class="settings-item-hint">Coming soon <!-- GitHub Issue #7 --></span>
                    </div>
                    <div class="settings-item settings-item-disabled">
                        <span class="settings-item-label">Sharing Summary</span>
                        <span class="settings-item-hint">Coming soon <!-- GitHub Issue #8 --></span>
                    </div>
                </section>

                <!-- About Section -->
                <section class="settings-section">
                    <h2 class="settings-section-title">About</h2>
                    <div class="settings-item">
                        <span class="settings-item-label">Version</span>
                        <span class="settings-item-value">0.5.0</span>
                    </div>
                    <div class="settings-item">
                        <span class="settings-item-label">Privacy-first location sharing</span>
                    </div>
                </section>
            </main>
        </section>
        <!-- End Settings View -->

        <!-- Tab Bar (only visible when logged in) -->
        <nav class="tab-bar hidden" id="tab-bar" role="tablist" aria-label="Main navigation">
            <button class="tab-item active" data-tab="main" role="tab" aria-selected="true" aria-controls="view-main">
                <span class="tab-icon" aria-hidden="true">üë•</span>
                <span class="tab-label">Contacts</span>
            </button>
            <button class="tab-item" data-tab="places" role="tab" aria-selected="false" aria-controls="view-places">
                <span class="tab-icon" aria-hidden="true">üìç</span>
                <span class="tab-label">Places</span>
            </button>
            <!-- GitHub Issue #6 -->
            <button class="tab-item" data-tab="circles" role="tab" aria-selected="false" disabled aria-disabled="true">
                <span class="tab-icon" aria-hidden="true">‚≠ï</span>
                <span class="tab-label">Circles</span>
            </button>
        </nav>
    </div>

    <!-- Modal for saving location -->
    <div id="save-modal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2>Save This Place</h2>
                <button id="modal-close-btn" class="modal-close">&times;</button>
            </div>
            <form id="save-location-form" class="modal-body">
                <div class="form-group">
                    <label for="location-label">Name</label>
                    <input
                        type="text"
                        id="location-label"
                        name="label"
                        placeholder="e.g., Home, Office, Gym"
                        required
                        maxlength="50"
                        autocomplete="off"
                    >
                </div>
                <div class="form-group">
                    <label for="location-radius">Radius</label>
                    <select id="location-radius" name="radius">
                        <option value="150" selected>Street (~150m)</option>
                        <option value="750">Neighborhood (~750m)</option>
                        <option value="10000">City (~10km)</option>
                    </select>
                    <p class="form-help">How close do you need to be to count as "here"?</p>
                </div>
                <div class="form-group">
                    <label>Current Location</label>
                    <p id="modal-current-location" class="form-static">Loading...</p>
                </div>
                <div class="modal-actions">
                    <button type="button" id="modal-cancel-btn" class="btn">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Place</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Auth Modal -->
    <div id="auth-modal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="auth-modal-title">Log In</h2>
                <button id="auth-modal-close-btn" class="modal-close">&times;</button>
            </div>
            <form id="auth-form" class="modal-body">
                <div id="auth-name-group" class="form-group hidden">
                    <label for="auth-name">Name</label>
                    <input type="text" id="auth-name" name="name" placeholder="Your name" autocomplete="name">
                </div>
                <div class="form-group">
                    <label for="auth-email">Email</label>
                    <input type="email" id="auth-email" name="email" placeholder="you@example.com" required autocomplete="email">
                </div>
                <div class="form-group">
                    <label for="auth-password">Password</label>
                    <input type="password" id="auth-password" name="password" placeholder="Password" required autocomplete="current-password" minlength="6">
                </div>
                <div id="auth-error" class="form-error hidden"></div>
                <div class="modal-actions">
                    <button type="submit" id="auth-submit-btn" class="btn btn-primary">Log In</button>
                </div>
                <p id="auth-switch" class="auth-switch">
                    Don't have an account? <a href="#" id="auth-switch-link">Sign up</a>
                </p>
            </form>
        </div>
    </div>

    <!-- Add Contact Modal -->
    <div id="add-contact-modal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add Contact</h2>
                <button id="add-contact-close-btn" class="modal-close">&times;</button>
            </div>
            <form id="add-contact-form" class="modal-body">
                <div class="form-group">
                    <label for="contact-email">Email Address</label>
                    <input type="email" id="contact-email" name="email" placeholder="friend@example.com" required>
                    <p class="form-help">Enter the email address of the person you want to add</p>
                </div>
                <div id="add-contact-error" class="form-error hidden"></div>
                <div class="modal-actions">
                    <button type="button" id="add-contact-cancel-btn" class="btn">Cancel</button>
                    <button type="submit" class="btn btn-primary">Send Request</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Scripts (order matters) -->
    <script src="storage.js"></script>
    <script src="geofence.js"></script>
    <script src="api.js"></script>
    <script src="views.js"></script>
    <script src="app.js"></script>
</body>
</html>
